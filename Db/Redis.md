## Redis

## 1. Install & Run For Windows

    [下载链接](https://github.com/tporadowski/redis)

    ![Redis安装](http://m.biancheng.net/uploads/allimg/210913/131Ga535-0.gif)

* 文件说明

    ![redis安装](http://m.biancheng.net/uploads/allimg/210913/131G91346-1.gif)

    

## 2.Redis 持久化

> 持久化拥有三种方式

### 2.1快照方式-RDB

将某一个时刻的内存数据，以二进制的方式写入磁盘；

#### 2.1.1 RDB 优点

RDB 的内容为二进制的数据，占用内存更小，更紧凑，更适合做为备份文件；
RDB 对灾难恢复非常有用，它是一个紧凑的文件，可以更快的传输到远程服务器进行 Redis 服务恢复；
RDB 可以更大程度的提高 Redis 的运行速度，因为每次持久化时 Redis 主进程都会 fork() 一个子进程，进行数据持久化到磁盘，Redis 主进程并不会执行磁盘 I/O 等操作；
与 AOF 格式的文件相比，RDB 文件可以更快的重启。

#### 2.1.2 RDB 缺点

因为 RDB 只能保存某个时间间隔的数据，如果中途 Redis 服务被意外终止了，则会丢失一段时间内的 Redis 数据；
RDB 需要经常 fork() 才能使用子进程将其持久化在磁盘上。如果数据集很大，fork() 可能很耗时，并且如果数据集很大且 CPU 性能不佳，则可能导致 Redis 停止为客户端服务几毫秒甚至一秒钟。

#### 2.1.3 使用方式

##### 手动触法

**Save命令**

在客户端中执行 save 命令，就会触发 Redis 的持久化，但同时也是使 Redis 处于阻塞状态，直到 RDB 持久化完成，才会响应其他客户端发来的命令，所以在生产环境一定要慎用。

**bgsave命令**

bgsave（background save）既后台保存的意思， 它和 save 命令最大的区别就是 bgsave 会 fork() 一个子进程来执行持久化，整个过程中只有在 fork() 子进程时有短暂的阻塞，当子进程被创建之后，Redis 的主进程就可以响应其他客户端的请求了，相对于整个流程都阻塞的 save 命令来说，显然 bgsave 命令更适合我们使用。

##### 自动触发(redis.server.config)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-08-23-11-12-54-image.png)

其中比较重要的参数如下列表：
① save 参数 它是用来配置触发 RDB 持久化条件的参数，满足保存条件时将会把数据持久化到硬盘。 默认配置说明如下：
• save 900 1：表示 900 秒内如果至少有 1 个 key 值变化，则把数据持久化到硬盘；
• save 300 10：表示 300 秒内如果至少有 10 个 key 值变化，则把数据持久化到硬盘；
• save 60 10000：表示 60 秒内如果至少有 10000 个 key 值变化，则把数据持久化到硬盘。
② rdbcompression 参数 它的默认值是 yes 表示开启 RDB 文件压缩，Redis 会采用 LZF 算法进行压缩。如果不想消耗 CPU 性能来进行文件压缩的话，可以设置为关闭此功能，这样的缺点是需要更多的磁盘空间来保存文件。
③ rdbchecksum 参数 它的默认值为 yes 表示写入文件和读取文件时是否开启 RDB 文件检查，检查是否有无损坏，如果在启动是检查发现损坏，则停止启动

### 2.2 AOF

记录所有的操作命令，并以文本的形式追加到文件中；

#### 2.2.1 AOF优点

AOF 持久化保存的数据更加完整
AOF 提供了三种保存策略：每次操作保存、每秒钟保存一次、跟随系统的持久化策略保存，
其中每秒保存一次，从数据的安全性和性能两方面考虑是一个不错的选择，也是 AOF 默认的策略，即使发生了意外情况，最多只会丢失 1s 钟的数据；
AOF 采用的是命令追加的写入方式，所以不会出现文件损坏的问题，即使由于某些意外原因，导致了最后操作的持久化数据写入了一半，也可以通过 redis-check-aof 工具轻松的修复；
AOF 持久化文件，非常容易理解和解析，它是把所有 Redis 键值操作命令，以文件的方式存入了磁盘。即使不小心使用 flushall 命令删除了所有键值信息，只要使用 AOF 文件，删除最后的 flushall 命令，重启 Redis 即可恢复之前误删的数据。

#### 2.2.2 AOF缺点

对于相同的数据集来说，AOF 文件要大于 RDB 文件；
在 Redis 负载比较高的情况下，RDB 比 AOF 性能更好；
RDB 使用快照的形式来持久化整个 Redis 数据，而 AOF 只是将每次执行的命令追加到 AOF 文件中，因此从理论上说，RDB 比 AOF 更健壮。

Redis 为我们提供了另一种持久化的方案——AOF。
AOF：把 Redis 每个键值对操作都记录到文件（appendonly.aof）中。
AOF 持久化开启之后，只要满足一定条件，就会触发 AOF 持久化。
AOF 的触发条件分为两种：自动触发和手动触发。

#### 2.2.3 使用方式

##### 手动触法

在客户端执行 bgrewriteaof 命令就可以手动触发 AOF 持久化，如下图所示  
可以看出执行完 bgrewriteaof 命令之后，AOF 持久化就会被触发。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200907131503768.png#pic_center)

##### 自动触法

- 合理的设置 AOF 的配置，可以保障 Redis 高效且稳定的运行，以下是 AOF 的全部配置信息和说明。
- AOF 的配置参数在 Redis 的配置文件中，也就是 Redis 根路径下的 redis.conf 文件中，配置参数和说明如下：

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-08-23-11-45-51-image.png)

- 其中比较重要的是 appendfsync 参数，用它来设置 AOF 的持久化策略，可以选择按时间间隔或者操作次数来存储 AOF 文件
