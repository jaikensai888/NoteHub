# 图像处理技术

## 计算机图像原理

![img](E:\文档\NoteHub\AI\图像处理技术.assets\v2-781b9a8c7dea3b91131e75418a4412f5_b.webp)

在这个矩阵里，每一个像素就是矩阵中的一个元素。在三通道的彩色图像中，这个元素是由三个数字组成的元组。

![img](E:\文档\NoteHub\AI\图像处理技术.assets\v2-aeaa9b61f15a322ed76e44e6d0eb8158_b.webp)

而对于单通道的灰度图像来说，这个元素就是一个数字。这个数字代表了图像在这个点的亮度，数字越大像素点也就越亮，在常见的八位单通道色彩空间中，0代表全黑，255代表全白。

## 灰值化

> [灰度图像](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/灰度图像)：也称为灰阶图像: 图像中每个像素可以由0(黑)到255(白)的亮度值(Intensity)表示。0-255之间表示不同的灰度级。
> 
> 将彩色图像转化成为灰度图像的过程称为图像的灰度化处理。

### 灰度化方法

一般有四种方法对彩色图像进行灰度化处理：分量法、最大值法、平均值法、加权平均法。

#### 最大值法

将彩色图像中的三分量亮度的最大值作为灰度图的灰度值。

```swift
f(i,j)=max(R(i,j),G(i,j),B(i,j))
```

#### 平均值法

将彩色图像中的三分量亮度求平均得到一个灰度值。

```undefined
f(i,j)=(R(i,j)+G(i,j)+B(i,j)) /3
```

#### 分量法

将彩色图像中的三分量的亮度作为三个灰度图像的灰度值，可根据应用需要选取一种灰度图像。

```undefined
f1(i,j)=R(i,j) 
f2(i,j)=G(i,j) 
f3(i,j)=B(i,j)
其中fk(i,j)(k=1,2,3)为转换后的灰度图像在（i,j）处的灰度值。
```

#### 加权平均法

 根据重要性及其它指标，将三个分量以不同的权值进行加权平均。由于人眼对绿色的敏感最高，对蓝色敏感最低，因此，按下式对RGB三分量进行加权平均能得到较合理的灰度图像。

```undefined
f(i,j)=0.30R(i,j)+0.59G(i,j)+0.11B(i,j))
```

参考文献

https://www.jianshu.com/p/6d7539edad97

## 边缘检测

### 原理

* 图像梯度
  
  > 图像相邻像素的灰度值得变化幅度；
  > 基础原理，原图灰度值+幅度值=增强后的变化；
  > 
  > 先以X，Y方向上分别分别对比，然后使用物理合力的方法将X，Y结合，成为“合力” 带有方向的矢量；通过计算矢量的值，以及变化角度，评估出其变化梯度；
  
  参考文献:
  
  [图像梯度实现原理](https://zhuanlan.zhihu.com/p/113397988)

### 步骤

#### 滤波

> 边缘检测的算法主要是基于图像强度的一阶和二阶导数，但导数通常对噪声很敏感，因此必须采用滤波器来改善与噪声有关的边缘检测器的性能。常见的滤波方法主要有高斯滤波，即采用离散化的高斯函数产生一组归一化的高斯核（具体见“高斯滤波原理及其编程离散化实现方法”一文），然后基于高斯核函数对图像灰度矩阵的每一点进行加权求和（具体程序实现见下文）
> 
> 原文链接：https://blog.csdn.net/poem_qianmo/article/details/25560901

#### 增强（锐化）

> 增强边缘的基础是确定图像各点邻域强度的变化值。增强算法可以将图像灰度点邻域强度值有显著变化的点凸显出来。在具体编程实现时，可通过计算梯度幅值来确定。

#### 检测

>  经过增强的图像，往往邻域中有很多点的梯度值比较大，而在特定的应用中，这些点并不是我们要找的边缘点，所以应该采用某种方法来对这些点进行取舍。实际工程中，常用的方法是通过阈值化方法来检测。

## 常用算法（算子）

> 基于上述图像梯度的逻辑，已有的增强算法

### cany算子

### soble算子

### Laplace算子

### Usm锐化增强算法

## 图像膨胀与腐蚀

> 二值化原图像与核进行运算，得出新的图像;
> 
> 核可以是任何的形状和大小，它拥有一个单独定义出来的参考点，我们称其为**锚点（anchorpoint）**

### 图像膨胀

> 膨胀可以理解为B的中心（锚点）沿着A的**外边界**走了一圈。膨胀是对高亮部分而言，**A区域之外的部分 < A的高亮像素**，所里外面被里面取代。
> 
> ![image-20210929114745655](E:\文档\NoteHub\AI\图像处理技术.assets\image-20210929114745655.png)

![image-20210929114257187](E:\文档\NoteHub\AI\图像处理技术.assets\image-20210929114257187-16328869817262.png)

### 图像腐蚀

> 腐蚀可以理解为B的中心（锚点）沿着A的**内边界**走了一圈。腐蚀也是对高亮部分而言，**A区域之外的部分 < A的高亮像素**，所里里面被外面取代。
> 
> ![image-20210929114825448](E:\文档\NoteHub\AI\图像处理技术.assets\image-20210929114825448-16328873076586.png)

![image-20210929114323423](E:\文档\NoteHub\AI\图像处理技术.assets\image-20210929114323423-16328871264033-16328871288334.png)

参考文献:https://www.jianshu.com/p/fc07d3065cf1

## 二值化（图形分割）

> [二值图像](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/二值图像)：图像中每个像素的亮度值(Intensity)仅可以取自0或1的图像，因此也称为1-bit图像。
> 
> 二值图像也常常用作原始图像的**掩模（又称遮罩、蒙版，Mask）**

### 阈值法

> 阈值法是指选取一个数字，大于它就视为全白，小于它就视为全黑

#### 全局阈值

>  全局阈值，指的是对整个图像中的每一个像素都选用相同的阈值

例子：可以看到阈值色阶从1到255的移动过程中，图像变黑的区域越来越多。当阈值数字在某个特定范围内的时候，红米肠的轮廓清晰可辨。

![img](E:\文档\NoteHub\AI\图像处理技术.assets\v2-7551038df1e95db2e15be1fac818f306_720w.jpg)

![img](E:\文档\NoteHub\AI\图像处理技术.assets\v2-b3afb3378ad9afb9feece25d426c9541_b.webp)

#### 局部阈值（自适应阈值）

> 局部阈值法假定图像在一定区域内受到的光照比较接近。它用一个滑窗扫描图像，并取**滑窗中心点**亮度与**滑窗内其他区域（称为邻域, neighborhood area）**的亮度进行比较。如果**中心点**亮度高于**邻域**亮度，则将**中心点**标记为白色，否则标记为黑色。

例子:聚光灯照在一个特定区域，产生局部受光、局部不受光的画面。

![img](E:\文档\NoteHub\AI\图像处理技术.assets\v2-7cab1df4a3f05d5f17cd4bf083daa492_720w.jpg)

对于局部受光的图像进行全局阈值，可能会出现“无论设置什么阈值参数，都无法满足全图要求”的尴尬。比如上面这幅图像，直接进行全局阈值时;

![img](https://pic4.zhimg.com/80/v2-e76e6e6aabc7e3bb0547c8c8e298152b_720w.jpg)

![img](.\图像处理技术.assets\v2-764361514fd3e60fbb96925504d08b71_720w.jpg)

参考文献：https://zhuanlan.zhihu.com/p/360824614

## 透视变换

>  透视变换是将图像从一个视平面投影到另外一个视平面的过程，所以透视变换也被称为投影映射

![使用 OpenCV 对图像中的区域进行透视变换](E:\文档\NoteHub\AI\图像处理技术.assets\v2-762b16b11a937cca3cac6aeb8c305cb1_1440w.jpg)

## 模糊

> 通常，图像处理软件会提供"模糊"（blur）滤镜，使图片产生模糊的效果。
> 本质上，它是一种[数据平滑技术](https://en.wikipedia.org/wiki/Smoothing)（data smoothing），适用于多个场合，图像处理恰好提供了一个直观的应用实例

所谓"模糊"，可以理解成每一个像素都取周边像素的平均值。

![img](http://www.ruanyifeng.com/blogimg/asset/201211/bg2012111403.png)

上图中，2是中间点，周边点都是1。

![img](http://www.ruanyifeng.com/blogimg/asset/201211/bg2012111404.png)

"中间点"取"周围点"的平均值，就会变成1。在数值上，这是一种"平滑化"。在图形上，就相当于产生"模糊"效果，"中间点"失去细节。

![img](http://www.ruanyifeng.com/blogimg/asset/201211/bg2012111405.jpg)

显然，计算平均值时，取值范围越大，"模糊效果"越强烈。

![img](http://www.ruanyifeng.com/blogimg/asset/201211/bg2012111406.jpg)

上面分别是原图、模糊半径3像素、模糊半径10像素的效果。模糊半径越大，图像就越模糊。从数值角度看，就是数值越平滑。

接下来的问题就是，既然每个点都要取周边像素的平均值，那么应该如何分配权重呢？

如果使用简单平均，显然不是很合理，因为图像都是连续的，越靠近的点关系越密切，越远离的点关系越疏远。因此，加权平均更合理，距离越近的点权重越大，距离越远的点权重越小。

### 高斯模糊

> 使用正态分布作为均值权重

正态分布显然是一种可取的权重分配模式。

![img](http://www.ruanyifeng.com/blogimg/asset/201211/bg2012111407.png)

在图形上，正态分布是一种钟形曲线，越接近中心，取值越大，越远离中心，取值越小。

计算平均值的时候，我们只需要将"中心点"作为原点，其他点按照其在正态曲线上的位置，分配权重，就可以得到一个加权平均值。

每个点乘以对应加权值进行均值计算

参考文献（说得好）:http://www.ruanyifeng.com/blog/2012/11/gaussian_blur.html

## 图像金字塔（缩放使用）

### 高斯金字塔

>  高斯金字塔是通过高斯平滑和亚采样获得一系列下采样图像，也就是说第K层高斯金字塔通过平滑、亚采样就可以获得K+1层高斯图像，高斯金字塔包含了一系列低通滤波器，其截至频率从上一层到下一层是以因子2逐渐增加，所以高斯金字塔可以跨越很大的频率范围。金字塔的图像如下：

 ![img](E:\文档\NoteHub\AI\图像处理技术.assets\70.png)

另外，每一层都按从下到上的次序编号， 层级 G_i+1 (表示为 G_i+1尺寸小于第i层G_i)。

* 对图像的向下取样操作，即缩小图像。
  为了获取层级为 G_i+1 的金字塔图像，方法步骤如下：
  
  1. 对图像G_i进行高斯内核卷积，进行高斯模糊；
  
  2. 将所有偶数行和列去除。
  
  得到的图像即为G_i+1的图像，显而易见，结果图像只有原图的四分之一。通过对输入图像G_i(原始图像)不停迭代以上步骤就会得到整个金字塔。同时我们也可以看到，向下取样会逐渐丢失图像的信息。以上就是对图像的向下取样操作，即缩小图像。

* 对图像的向上取样，即放大图像
  方法步骤如下：
  
  1. 将图像在每个方向扩大为原来的两倍，新增的行和列以0填充
  
  2. 使用先前同样的内核(乘以4)与放大后的图像卷积，获得 “新增像素”的近似值
  
  得到的图像即为放大后的图像，但是与原来的图像相比会发觉比较模糊，因为在缩放的过程中已经丢失了一些信息，如果想在缩小和放大整个过程中减少信息的丢失，这些数据形成了拉普拉斯金字塔。

### 双边滤波

> 选择性使用结构元素

参考资料:https://zhuanlan.zhihu.com/p/127023952

### 拉普拉斯金字塔

> 拉普拉斯金字塔（The Laplacian pyramid）就是 ：每一层的图像是由 ：拉普拉斯金字塔中的第i层，等于「高斯金字塔中的第i层」与「高斯金字塔中的第i+1层的向上采样结果」之差。
> 
> 拉普拉斯金字塔是一个"高斯差值金字塔"。
> 所以拉普拉斯金字塔实际上是保存的是损失部分信息。

![img](https://img-blog.csdnimg.cn/20200613141329184.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Z0aW1lcw==,size_16,color_FFFFFF,t_70)

参考文献:

[高斯金字塔](https://blog.csdn.net/zhu_hongji/article/details/81536820)

[拉普拉斯金字塔](https://blog.csdn.net/ftimes/article/details/106731558)

## 轮廓

参考文献:https://zhuanlan.zhihu.com/p/61328775

## 图像模板匹配

## 颜色分割或者阔值分割

> 通过滤波转换成HSV 然后通过颜色取值范围制造过滤层，对照片进行过滤运算

hsv取值在线页面:https://www.tydac.ch/color/

参考文献：https://zhuanlan.zhihu.com/p/163841608

## 闭运算与开运算

### 开运算

>  先腐蚀后膨胀叫开运算（因为先腐蚀会分开物体，这样容易记住），其作用是：分离物体，消除小区域。

### 闭运算

> 先膨胀后腐蚀（先膨胀会使白色的部分扩张，以至于消除/"闭合"物体里面的小黑洞，所以叫闭运算）

## 投影分割

> 通常用于切割图片，文字分词

### 水平投影

二维图像(二值图)在y轴上的投影；

![preview](E:\文档\NoteHub\AI\图像处理技术.assets\v2-46e53af44acb1cee65f647052f2a3fe6_r.jpg)

### 垂直投影

二维图像(二值图)在x轴上的投影。

## 知识点

### 图像深度

> 单个像素点使用的位数(bit) **-图像深度是指像素深度中实际用于存储图像的灰度或色彩所需要的比特位数**
> 图像深度决定了图像的每个像素可能的颜色数,或可能的灰度级数
> 
> 例如，彩色图像每个像素用R,G,B三个分量表示,每个分量用8位，像素深度为24位

### 图片灰度

> 图片灰度可以人为是亮度，即颜色的深浅；三原色的深浅组合，可以组成更多不同颜色；
> 
> 例如三原色16级灰度，那么能显示的颜色就是16X16X16=4096色
> 
> RGB(50,50,50) 里面的数组就是对应三原色的灰度；

- 裁剪
- 缩放、插值和重新调整大小
- 轮廓
- 使用霍夫线检测线
- 寻找角落
- 计算圆和椭圆
